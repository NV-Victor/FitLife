- [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
- [–ë–∞–∑–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è](#–±–∞–∑–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
  - [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å Order Service Node](#–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å-order-service-node)
    - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è order\_service](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è-order_service)
    - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker –¥–ª—è order\_service](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-docker-–¥–ª—è-order_service)
  - [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å Logistics Service Node](#–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å-logistics-service-node)
    - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è logistics-service](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è-logistics-service)
    - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker –¥–ª—è logistics-service](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-docker-–¥–ª—è-logistics-service)
  - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker Compose](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-docker-compose)
  - [–†–∞–±–æ—Ç–∞ —Å Docker Compose](#—Ä–∞–±–æ—Ç–∞-—Å-docker-compose)
  - [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏-—Å–µ—Ä–≤–∏—Å–æ–≤)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ POST /orders](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å–µ—Ä–≤–∏—Å–∞-post-orders)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ PUT /orders/1](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å–µ—Ä–≤–∏—Å–∞-put-orders1)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ POST /deliveries](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å–µ—Ä–≤–∏—Å–∞-post-deliveries)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ PUT /deliveries/1](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å–µ—Ä–≤–∏—Å–∞-put-deliveries1)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö orders](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö-orders)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö deliveries](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö-deliveries)
- [–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã](#–ø–æ–ª–µ–∑–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã)

# –í–≤–µ–¥–µ–Ω–∏–µ

–î–µ–ª–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —É—Ä–æ–∫–∞: –°—Å—ã–ª–∫–∞ –Ω–∞ —É—Ä–æ–∫: [–°–ø—Ä–∏–Ω—Ç 1/11: –°–ø—Ä–∏–Ω—Ç 1. 26.05 - 08.06 –ú–î üü¢ ‚Üí –¢–µ–º–∞ 2/4: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π ‚Üí –£—Ä–æ–∫ 5/6: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ Docker Compose]( https://practicum.yandex.ru/learn/software-architect/courses/958ef1df-e5b3-4055-b01e-540e479ca32f/sprints/573874/topics/9f086841-5d67-43d6-981e-b5d5af07d6de/lessons/a6abafe8-d9c8-44ce-9180-1ade7f58af72/#bc6441a6-b794-4fe3-8139-4a44bdfc56dd )


–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –¥–≤–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞: `Order Service Node` –∏ `Logistics Service Node`.

**Order Service Node**:
- –∏–º–µ–µ—Ç —Å–µ—Ä–≤–∏—Å `POST /orders`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –≤ –ë–î order —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ –¢–æ–≤–∞—Ä. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 201 Order created successfully. Order —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º *Pending*.
- –∏–º–µ–µ—Ç —Å–µ—Ä–≤–∏—Å `PUT /orders/{order_id}`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å order –ø–æ –µ–≥–æ id.  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 201 Order updated successfully, –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–∞–π–¥–µ–Ω. –ò–ª–∏ 404 Order not found, –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω.
- —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```
order-service/
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ swagger.yml
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ db_utils.py
```

**Logistics Service Node**
- –∏–º–µ–µ—Ç —Å–µ—Ä–≤–∏—Å `POST /deliveries`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å delivery —Å order_id –∏ –≤ —Å—Ç–∞—Ç—É—Å–µ In Transit. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 201 Delivery created successfully.
- –∏–º–µ–µ—Ç —Å–µ—Ä–≤–∏—Å `PUT /deliveries`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å delivery –ø–æ –µ–µ id.  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 201 Delivery updated successfully, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –¥–æ—Å—Ç–∞–≤–∫–∏  –Ω–∞–π–¥–µ–Ω–∞. –ò–ª–∏ 404 Delivery not found, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–Ω–∞.
- —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```
logistics-service/
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ swagger.yml
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ db_utils.py
```


# –ë–∞–∑–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
## –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å Order Service Node
### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è order_service

1. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `order-service`.
   
*–ü–∞–ø–∫—É –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å –≤ –ª—é–±–æ–µ –º–µ—Å—Ç–æ, –≥–ª–∞–≤–Ω–æ–µ –ø–æ—Ç–æ–º –≤ –Ω–µ–µ –ø–µ—Ä–µ–π—Ç–µ. –Ø —Å–æ–∑–¥–∞–ª –∑–¥–µ—Å—å `/home/ubuntu/YandexPracticum/ArchPO/Practice/S1T2L5/order_service/`*

2. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–ø–∫—É —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `app.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```Python
from flask import Flask, request, jsonify
from db.models import db, Order
from utils.db_utils import init_db
import os

app = Flask(__name__)

#app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://postgres:mysecretpassword@db:5432/orders'

app.config['SQLALCHEMY_DATABASE_URI'] = os.getenv("DATABASE_URL")

db.init_app(app)

@app.route('/orders', methods=['POST'])
def create_order():
    data = request.get_json()
    new_order = Order(customer_name=data['customer_name'], item=data['item'], status='Pending')
    db.session.add(new_order)
    db.session.commit()
    return jsonify({'message': 'Order created successfully'}), 201

@app.route('/orders/<int:order_id>', methods=['PUT'])
def update_order(order_id):
    data = request.get_json()
    order = Order.query.get(order_id)
    if not order:
        return jsonify({'message': 'Order not found'}), 404
    order.status = data['status']
    db.session.commit()
    return jsonify({'message': 'Order updated successfully'})

if __name__ == '__main__':
    with app.app_context():
        init_db()
    app.run(host='0.0.0.0', port=5000)
```
3. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–ø–∫—É —Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `requirements.txt` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```
flask
flask_sqlalchemy
psycopg2-binary
```
4. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–ø–∫—É —Ñ–∞–π–ª —Å–≤–∞–≥–≥–µ—Ä–∞ `swagger.yml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```yaml
swagger: '2.0'
info:
  title: Order Service API
  version: 1.0.0
paths:
  /orders:
    post:
      summary: Create a new order
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              customer_name:
                type: string
              item:
                type: string
      responses:
        201:
          description: Order created successfully
  /orders/{order_id}:
    put:
      summary: Update an order
      consumes:
        - application/json
      parameters:
        - in: path
          name: order_id
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              status:
                type: string
      responses:
        200:
          description: Order updated successfully
        404:
          description: Order not found
```

5. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `order_service/db/`.
6. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –Ω–µ–µ —Ñ–∞–π–ª `models.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```python
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

class Order(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    customer_name = db.Column(db.String(80), nullable=False)
    item = db.Column(db.String(120), nullable=False)
    status = db.Column(db.String(20), nullable=False)
```

7. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `order_service/utils/`
8. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –Ω–µ–µ —Ñ–∞–π–ª `db_utils.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:
```python
from db.models import db

def init_db():
    db.create_all()
```

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker –¥–ª—è order_service

1. –ü–æ–ª–æ–∂–∏—Ç—å —Ñ–∞–π–ª `DockerFile` –≤ –ø–∞–ø–∫—É `order_service` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```dockerfile
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ Python
FROM python:3.8-slim

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
COPY . /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN pip install --no-cache-dir -r requirements.txt

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
CMD ["python", "app.py"]
```

## –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å Logistics Service Node
### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è logistics-service

1. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `logistics-service`.
   
*–ü–∞–ø–∫—É –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å –≤ –ª—é–±–æ–µ –º–µ—Å—Ç–æ, –≥–ª–∞–≤–Ω–æ–µ –ø–æ—Ç–æ–º –≤ –Ω–µ–µ –ø–µ—Ä–µ–π—Ç–µ. –Ø —Å–æ–∑–¥–∞–ª –∑–¥–µ—Å—å `/home/ubuntu/YandexPracticum/ArchPO/Practice/S1T2L5/logistics-service/`*

2. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–ø–∫—É —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `app.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```Python
from flask import Flask, request, jsonify
from db.models import db, Delivery
from utils.db_utils import init_db
import os

app = Flask(__name__)

# app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://postgres:password@db:5432/logistics'

app.config['SQLALCHEMY_DATABASE_URI'] = os.getenv("DATABASE_URL")

db.init_app(app)

@app.route('/deliveries', methods=['POST'])
def create_delivery():
    data = request.get_json()
    new_delivery = Delivery(order_id=data['order_id'], status='In Transit')
    db.session.add(new_delivery)
    db.session.commit()
    return jsonify({'message': 'Delivery created successfully'}), 201

@app.route('/deliveries/<int:delivery_id>', methods=['PUT'])
def update_delivery(delivery_id):
    data = request.get_json()
    delivery = Delivery.query.get(delivery_id)
    if not delivery:
        return jsonify({'message': 'Delivery not found'}), 404
    delivery.status = data['status']
    db.session.commit()
    return jsonify({'message': 'Delivery updated successfully'})

if __name__ == '__main__':
    with app.app_context():
        init_db()
    app.run(host='0.0.0.0', port=5001)
```
3. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–ø–∫—É —Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `requirements.txt` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```
flask
flask_sqlalchemy
psycopg2-binary
```
4. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–ø–∫—É —Ñ–∞–π–ª —Å–≤–∞–≥–≥–µ—Ä–∞ `swagger.yml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```yaml
swagger: '2.0'
info:
  title: Logistics Service API
  version: 1.0.0
paths:
  /deliveries:
    post:
      summary: Create a new delivery
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              order_id:
                type: integer
      responses:
        201:
          description: Delivery created successfully
  /deliveries/{delivery_id}:
    put:
      summary: Update a delivery
      consumes:
        - application/json
      parameters:
        - in: path
          name: delivery_id
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              status:
                type: string
      responses:
        200:
          description: Delivery updated successfully
        404:
          description: Delivery not found
```

5. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `logistics-service/db/`.
6. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –Ω–µ–µ —Ñ–∞–π–ª `models.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```python
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

class Delivery(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    order_id = db.Column(db.Integer, nullable=False)
    status = db.Column(db.String(20), nullable=False)
```

7. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `logistics-service/utils/`
8. –ü–æ–ª–æ–∂–∏—Ç—å –≤ –Ω–µ–µ —Ñ–∞–π–ª `db_utils.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:
```python
from db.models import db

def init_db():
    db.create_all()
```

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker –¥–ª—è logistics-service

1. –ü–æ–ª–æ–∂–∏—Ç—å —Ñ–∞–π–ª `DockerFile` –≤ –ø–∞–ø–∫—É `logistics-service` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```dockerfile
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ Python
FROM python:3.8-slim

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
COPY . /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN pip install --no-cache-dir -r requirements.txt

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
CMD ["python", "app.py"]
```

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker Compose

1. –ü–æ–ª–æ–∂–∏—Ç—å —Ä—è–¥–æ–º —Å –ø–∞–ø–∫–∞–º–∏ `order_service` –∏ `logistics-service` —Ñ–∞–π–ª `docker-compose.yml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

*–£ –º–µ–Ω—è –ø–æ–ª—É—á–∏–ª—Å—è –ø—É—Ç—å: `/home/ubuntu/YandexPracticum/ArchPO/Practice/S1T2L5/`*

```yaml
version: '3.8'

services:
  order-service:
    build: ./order-service
    container_name: order-service-v3
    #command: tail -f /dev/null    #–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–º –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è app.py
    ports:
      - "5000:5000"
    environment:
      - DATABASE_URL=postgresql://postgres:${POSTGRES_PASSWORD}@db:5432/orders
    depends_on:
      - db
    networks:
      - quickdelivery-network

  logistics-service:
    build: ./logistics-service
    container_name: logistics-service
    #command: tail -f /dev/null    #–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–º –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è app.py
    ports:
      - "5001:5001"
    environment:
      - DATABASE_URL=postgresql://postgres:${POSTGRES_PASSWORD}@db:5432/logistics
    depends_on:
      - db
    networks:
      - quickdelivery-network

  db:
    image: postgres:13
    container_name: postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
      - postgres-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - quickdelivery-network

networks:
  quickdelivery-network:
    driver: bridge

volumes:
  postgres-data:
```
2. –ü–æ–ª–æ–∂–∏—Ç—å —Ä—è–¥–æ–º —Å –ø–∞–ø–∫–∞–º–∏ `order_service` –∏ `logistics-service` —Ñ–∞–π–ª `init.sql` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```sql
CREATE DATABASE orders;
CREATE DATABASE logistics;
```

3. –ü–æ–ª–æ–∂–∏—Ç—å —Ä—è–¥–æ–º —Å –ø–∞–ø–∫–∞–º–∏ `order_service` –∏ `logistics-service` —Ñ–∞–π–ª `.env` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```
POSTGRES_PASSWORD=mysecretpassword
```

## –†–∞–±–æ—Ç–∞ —Å Docker Compose

1. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã –∫–æ–º–∞–Ω–¥–æ–π:

–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å —Ñ–∞–π–ª–æ–º `docker-compose.yml`

```bash
docker-compose up --build 
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ POST /orders

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:

```bash
curl -X POST -H "Content-Type: application/json" -d '{"customer_name": "John Doe", "item": "Laptop"}' http://localhost:5000/orders 
```

*–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: `{"message":"Order created successfully"}`*

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ PUT /orders/1

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–∫–∞–∑–∞:

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"status": "Shipped"}' http://localhost:5000/orders/1
```

*–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: `{"message":"Order updated successfully"}`*

2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–∫–∞–∑–∞:

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"status": "Shipped"}' http://localhost:5000/orders/123
```

*–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: `{"message":"Order not found"}`*

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ POST /deliveries

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏:

```bash
curl -X POST -H "Content-Type: application/json" -d '{"order_id": 1}' http://localhost:5001/deliveries 
```

*–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: `{"message":"Delivery created successfully"}`*

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ PUT /deliveries/1

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏:

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"status": "Delivered"}' http://localhost:5001/deliveries/1
```

*–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: `{"message":"Delivery updated successfully"}`*

2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏:

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"status": "Delivered"}' http://localhost:5001/deliveries/123
```

*–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: `{"message":"Delivery not found"}`*

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö orders

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î orders –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```bash
docker exec -it postgres psql -U postgres -d orders
```
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–ª–µ–∫—Ç:
```sql
SELECT * FROM "order";
```
3. –í—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–æ–º–∞–Ω–¥–æ–π `exit`.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö deliveries

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î deliveries –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```bash
docker exec -it postgres psql -U postgres -d logistics
```
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–ª–µ–∫—Ç:
```sql
SELECT * FROM "delivery";
```
3. –í—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–æ–º–∞–Ω–¥–æ–π `exit`.

# –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- **docker network ls**                                        - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–µ—Ç–µ–π
- **docker network inspect s1t2l5_quickdelivery-network**      - –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ç–∏
- **docker-compose up --build**                                - —Å–±–æ—Ä–∫–∞ —á–µ—Ä–µ–∑ Docker Compose
- **docker-compose down --rmi all**                            - —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞–∑—ã —á–µ—Ä–µ–∑ Docker Compose
- **docker-compose down -v**                                   - —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —Ç–æ–º–∞ —á–µ—Ä–µ–∑ Docker Compose
- **docker exec -it order-service-v3 /bin/bash**               - –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ–µ
- **docker exec -it order-service-v3 env**                     - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **docker exec -it postgres psql -U postgres**                - –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ postgre –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ